# Enable OpenClaw Feishu Lark

<p align="center">
  <strong>ğŸ”— é£ä¹¦é•¿è¿æ¥å®¢æˆ·ç«¯ - å¿«é€Ÿæ¥å…¥é£ä¹¦äº‹ä»¶æ¨é€</strong>
</p>

<p align="center">
  <a href="#åŠŸèƒ½ç‰¹ç‚¹">åŠŸèƒ½ç‰¹ç‚¹</a> â€¢
  <a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a> â€¢
  <a href="#é…ç½®è¯´æ˜">é…ç½®è¯´æ˜</a> â€¢
  <a href="#äº‹ä»¶å¤„ç†">äº‹ä»¶å¤„ç†</a> â€¢
  <a href="#å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</a>
</p>

---

## ğŸ“– é¡¹ç›®ä»‹ç»

æœ¬é¡¹ç›®èƒ½å¤Ÿæ¿€æ´»é£ä¹¦çš„**é•¿è¿æ¥åŠŸèƒ½**ï¼Œé€šè¿‡ WebSocket ä¸é£ä¹¦å¼€æ”¾å¹³å°å»ºç«‹æŒä¹…çš„å…¨åŒå·¥é€šä¿¡é€šé“ï¼Œå®æ—¶æ¥æ”¶äº‹ä»¶æ¶ˆæ¯ã€‚

ç›¸è¾ƒäºä¼ ç»Ÿçš„ Webhook æ¨¡å¼ï¼Œé•¿è¿æ¥æ¨¡å¼å¤§å¤§é™ä½äº†æ¥å…¥æˆæœ¬ï¼Œå°†åŸå…ˆ 1 å‘¨å·¦å³çš„å¼€å‘å‘¨æœŸé™ä½åˆ° **5 åˆ†é’Ÿ**ã€‚

### ä»€ä¹ˆæ˜¯é•¿è¿æ¥ï¼Ÿ

é•¿è¿æ¥æ˜¯é£ä¹¦ SDK å†…æä¾›çš„èƒ½åŠ›ï¼Œå®ƒå…è®¸ä½ çš„æœ¬åœ°æœåŠ¡å™¨ä¸é£ä¹¦å¼€æ”¾å¹³å°å»ºç«‹ä¸€æ¡ WebSocket å…¨åŒå·¥é€šé“ã€‚å½“åº”ç”¨è®¢é˜…çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé£ä¹¦ä¼šé€šè¿‡è¯¥é€šé“å‘ä½ çš„æœåŠ¡å™¨å³æ—¶å‘é€äº‹ä»¶æ¶ˆæ¯ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

| ç‰¹ç‚¹ | æè¿° |
|------|------|
| ğŸš€ **å¿«é€Ÿæ¥å…¥** | 5åˆ†é’Ÿå³å¯å®Œæˆé…ç½®ï¼Œæ— éœ€å¤æ‚çš„æœåŠ¡å™¨éƒ¨ç½² |
| ğŸ”’ **å®‰å…¨ä¼ è¾“** | å†…ç½®åŠ å¯†å’Œé‰´æƒæœºåˆ¶ï¼Œæ•°æ®ä¼ è¾“å®‰å…¨å¯é  |
| ğŸŒ **æ— éœ€å…¬ç½‘** | æ— éœ€æä¾›å…¬ç½‘ IP æˆ–åŸŸåï¼Œæœ¬åœ°ç¯å¢ƒå³å¯è¿è¡Œ |
| ğŸ“¡ **å®æ—¶é€šä¿¡** | åŸºäº WebSocket çš„å…¨åŒå·¥é€šé“ï¼Œæ¶ˆæ¯å³æ—¶åˆ°è¾¾ |
| ğŸ”§ **å¼€ç®±å³ç”¨** | æ— éœ€é…ç½®å†…ç½‘ç©¿é€ã€é˜²ç«å¢™æˆ–ç™½åå• |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

- Node.js 16.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- npm æˆ– yarn åŒ…ç®¡ç†å™¨
- é£ä¹¦å¼€å‘è€…è´¦å·å’Œä¼ä¸šè‡ªå»ºåº”ç”¨

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/Futaoj/enable_openclaw_feishu_lark.git
cd enable_openclaw_feishu_lark
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åœ¨è¿è¡Œä¹‹å‰ï¼Œéœ€è¦è®¾ç½®é£ä¹¦åº”ç”¨çš„å‡­è¯ï¼š

```bash
export FEISHU_APP_ID="your_app_id"
export FEISHU_APP_SECRET="your_app_secret"
```

> ğŸ’¡ **è·å–åº”ç”¨å‡­è¯**ï¼šç™»å½• [é£ä¹¦å¼€å‘è€…åå°](https://open.feishu.cn/app)ï¼Œåœ¨åº”ç”¨è¯¦æƒ…é¡µçš„ã€Œå‡­è¯ä¸åŸºç¡€ä¿¡æ¯ã€>ã€Œåº”ç”¨å‡­è¯ã€åŒºåŸŸè·å–ã€‚

### 4. å¯åŠ¨é•¿è¿æ¥å®¢æˆ·ç«¯

```bash
npm run ws
# æˆ–
npm start
```

æˆåŠŸå¯åŠ¨åï¼Œä½ å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è¾“å‡ºï¼š

```
ğŸš€ æ­£åœ¨å¯åŠ¨é£ä¹¦é•¿è¿æ¥å®¢æˆ·ç«¯...
ğŸ“± App ID: cli_xxxxx...
[info]: [ 'client ready' ]
[debug]: [ '[ws]', 'ws connect success' ]
[info]: [ '[ws]', 'ws client ready' ]
âœ… é•¿è¿æ¥å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼Œç­‰å¾…äº‹ä»¶...
```

### 5. é…ç½®é£ä¹¦å¼€å‘è€…åå°

1. ç™»å½• [é£ä¹¦å¼€å‘è€…åå°](https://open.feishu.cn/app)
2. é€‰æ‹©ä½ çš„ä¼ä¸šè‡ªå»ºåº”ç”¨
3. è¿›å…¥ **äº‹ä»¶ä¸å›è°ƒ** > **äº‹ä»¶é…ç½®** é¡µé¢
4. åœ¨ã€Œè®¢é˜…æ–¹å¼ã€å¤„é€‰æ‹©ï¼š**ä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶**
5. ç‚¹å‡»ã€Œæ·»åŠ äº‹ä»¶ã€ï¼Œè®¢é˜…ä½ éœ€è¦çš„äº‹ä»¶ï¼ˆå¦‚ `im.message.receive_v1`ï¼‰
6. ä¿å­˜é…ç½®

> âš ï¸ **é‡è¦**ï¼šå¿…é¡»ç¡®ä¿æœ¬åœ°å®¢æˆ·ç«¯å¯åŠ¨æ­£å¸¸ï¼Œæœ‰é•¿è¿æ¥åœ¨çº¿çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½ä¿å­˜æˆåŠŸã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
enable_openclaw_feishu_lark/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ ws-client.js    # é•¿è¿æ¥å®¢æˆ·ç«¯ä¸»ç¨‹åº
â”œâ”€â”€ package.json        # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ package-lock.json   # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ .gitignore          # Git å¿½ç•¥é…ç½®
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…å¡« | æè¿° |
|--------|------|------|
| `FEISHU_APP_ID` | âœ… | é£ä¹¦åº”ç”¨çš„ App ID |
| `FEISHU_APP_SECRET` | âœ… | é£ä¹¦åº”ç”¨çš„ App Secret |

### ä½¿ç”¨ .env æ–‡ä»¶ï¼ˆæ¨èï¼‰

ä½ ä¹Ÿå¯ä»¥åˆ›å»º `.env` æ–‡ä»¶æ¥ç®¡ç†ç¯å¢ƒå˜é‡ï¼š

```bash
# .env
FEISHU_APP_ID=cli_xxxxxxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

ç„¶åå®‰è£… `dotenv` å¹¶åœ¨ä»£ç å¼€å¤´æ·»åŠ ï¼š

```javascript
import 'dotenv/config';
```

---

## ğŸ“¬ äº‹ä»¶å¤„ç†

### é»˜è®¤å¤„ç†çš„äº‹ä»¶

æœ¬é¡¹ç›®é»˜è®¤å¤„ç† `im.message.receive_v1`ï¼ˆæ¥æ”¶æ¶ˆæ¯ï¼‰äº‹ä»¶ï¼Œä¼šè‡ªåŠ¨å›å¤æ”¶åˆ°çš„æ–‡æœ¬æ¶ˆæ¯ã€‚

### æ·»åŠ æ›´å¤šäº‹ä»¶å¤„ç†å™¨

åœ¨ `src/ws-client.js` çš„ `eventDispatcher.register()` ä¸­æ·»åŠ æ›´å¤šäº‹ä»¶å¤„ç†å™¨ï¼š

```javascript
eventDispatcher: new Lark.EventDispatcher({}).register({
  // æ¥æ”¶æ¶ˆæ¯äº‹ä»¶
  'im.message.receive_v1': async (data) => {
    // å¤„ç†æ¶ˆæ¯...
  },
  
  // ç¾¤æˆå‘˜å¢åŠ äº‹ä»¶
  'im.chat.member.user.added_v1': async (data) => {
    console.log('æ–°æˆå‘˜åŠ å…¥ç¾¤èŠ:', data);
  },
  
  // å®¡æ‰¹ä»»åŠ¡çŠ¶æ€å˜åŒ–äº‹ä»¶
  'approval.approval.updated_v4': async (data) => {
    console.log('å®¡æ‰¹çŠ¶æ€æ›´æ–°:', data);
  }
})
```

### å¸¸ç”¨äº‹ä»¶ç±»å‹

| äº‹ä»¶ç±»å‹ | æè¿° |
|----------|------|
| `im.message.receive_v1` | æ¥æ”¶æ¶ˆæ¯ |
| `im.message.message_read_v1` | æ¶ˆæ¯å·²è¯» |
| `im.chat.member.user.added_v1` | ç”¨æˆ·è¿›ç¾¤ |
| `im.chat.member.user.deleted_v1` | ç”¨æˆ·å‡ºç¾¤ |
| `im.chat.disbanded_v1` | ç¾¤è§£æ•£ |

æ›´å¤šäº‹ä»¶è¯·å‚è€ƒ [é£ä¹¦äº‹ä»¶åˆ—è¡¨](https://open.feishu.cn/document/ukTMukTMukTM/uYDNxYjL2QTM24iN0EjN/event-list)ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä»…æ”¯æŒä¼ä¸šè‡ªå»ºåº”ç”¨** - å•†åº—åº”ç”¨æš‚ä¸æ”¯æŒé•¿è¿æ¥æ¨¡å¼
2. **3ç§’å¤„ç†æ—¶é™** - æ”¶åˆ°æ¶ˆæ¯åéœ€åœ¨ 3 ç§’å†…å¤„ç†å®Œæˆï¼Œå¦åˆ™ä¼šè§¦å‘è¶…æ—¶é‡æ¨
3. **è¿æ¥æ•°é™åˆ¶** - æ¯ä¸ªåº”ç”¨æœ€å¤šå»ºç«‹ 50 ä¸ªè¿æ¥
4. **é›†ç¾¤æ¨¡å¼** - å¤šå®¢æˆ·ç«¯éƒ¨ç½²æ—¶ï¼Œåªæœ‰éšæœºä¸€ä¸ªå®¢æˆ·ç«¯ä¼šæ”¶åˆ°æ¶ˆæ¯ï¼ˆä¸æ”¯æŒå¹¿æ’­ï¼‰

---

## â“ å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æç¤º"ç¼ºå°‘å¿…è¦çš„ç¯å¢ƒå˜é‡"ï¼Ÿ

A: è¯·ç¡®ä¿å·²æ­£ç¡®è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
export FEISHU_APP_ID="your_app_id"
export FEISHU_APP_SECRET="your_app_secret"
```

### Q: å¼€å‘è€…åå°ä¿å­˜è®¢é˜…æ–¹å¼å¤±è´¥ï¼Ÿ

A: å¿…é¡»ç¡®ä¿æœ¬åœ°å®¢æˆ·ç«¯å·²å¯åŠ¨ä¸”è¿æ¥æˆåŠŸåï¼Œæ‰èƒ½åœ¨åå°ä¿å­˜ã€Œä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶ã€çš„é…ç½®ã€‚

### Q: ä¸ºä»€ä¹ˆæ”¶ä¸åˆ°äº‹ä»¶æ¶ˆæ¯ï¼Ÿ

A: è¯·æ£€æŸ¥ï¼š
1. æ˜¯å¦åœ¨å¼€å‘è€…åå°æ­£ç¡®è®¢é˜…äº†å¯¹åº”äº‹ä»¶
2. åº”ç”¨æ˜¯å¦æœ‰å¯¹åº”çš„æƒé™
3. é•¿è¿æ¥æ˜¯å¦æ­£å¸¸å»ºç«‹ï¼ˆæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼‰

### Q: å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼Ÿ

A: å¯ä»¥ä½¿ç”¨ PM2 è¿›è¡Œè¿›ç¨‹ç®¡ç†ï¼š
```bash
npm install -g pm2
pm2 start src/ws-client.js --name feishu-ws
```

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
- [é£ä¹¦å¼€å‘è€…åå°](https://open.feishu.cn/app)
- [é£ä¹¦ SDK æ–‡æ¡£](https://open.feishu.cn/document/ukTMukTMukTM/uETO1YjLxkTN24SM5UjN)
- [äº‹ä»¶è®¢é˜…é…ç½®æŒ‡å—](https://open.feishu.cn/document/ukTMukTMukTM/uYDNxYjL2QTM24iN0EjN/event-subscription-configure-/use-long-connection-to-receive-events)
